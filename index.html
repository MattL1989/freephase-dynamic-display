<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>EDF FreePhase Dynamic</title>

<style>
body {
  background:#000;
  color:#fff;
  font-family:"Segoe UI",Arial,sans-serif;
  text-align:center;
  margin:0;
}
header { padding:30px 0 10px; }
h1 { font-size:42px; font-weight:600; margin-bottom:5px; }
.clock { font-size:18px; color:#bbb; margin-bottom:25px; }
h2 { font-size:28px; margin:30px 0 10px; }

.band-card {
  width:90%;
  margin:15px auto;
  padding:25px;
  border-radius:18px;
  font-size:26px;
  box-shadow:0 0 25px rgba(0,0,0,.4);
  transition:.3s;
}
.band-card.current {
  transform:scale(1.04);
  border:2px solid #fff;
  box-shadow:0 0 35px rgba(255,255,255,.25);
}

.green { background:#1f8f2e; }
.amber { background:#c9a200; }
.red   { background:#b00000; }

.dot {
  height:18px; width:18px;
  border-radius:50%;
  display:inline-block;
  margin-right:10px;
}
.dot.green { background:#58d46d; }
.dot.amber { background:#ffd84a; }
.dot.red   { background:#ff4c4c; }

.price { font-size:34px; font-weight:bold; margin:8px 0; }

.saving { font-size:18px; margin-top:5px; }
.saving.green { color:#58d46d; }
.saving.red { color:#ff4c4c; }

.greyed {
  opacity:.35;
  border:2px dashed #666;
}
</style>
</head>

<body>

<header>
<h1>EDF FreePhase Dynamic - ST15 0WL</h1>
<div class="clock" id="clock">Loading…</div>
</header>

<h2>Today</h2>
<div id="today-green-early"></div>
<div id="today-amber"></div>
<div id="today-red"></div>
<div id="today-green-late"></div>

<h2>Tomorrow</h2>
<div id="tomorrow-green-early"></div>
<div id="tomorrow-amber"></div>
<div id="tomorrow-red"></div>

<script>
const BASELINE = 25.65;

function updateClock(){
  document.getElementById("clock").innerText =
    new Date().toLocaleString("en-GB");
}
setInterval(updateClock,1000);
updateClock();

function savingText(price){
  const pct=((BASELINE-price)/BASELINE)*100;
  return pct>=0
    ? `<div class="saving green">▼ ${pct.toFixed(0)} percent below baseline</div>`
    : `<div class="saving red">▲ ${Math.abs(pct).toFixed(0)} percent above baseline</div>`;
}

function buildCard(id, band, price, time){
  const el=document.getElementById(id);
  const pending=price==null;

  el.innerHTML = `
  <div class="band-card ${band} ${pending?"greyed":""}" id="${id}-card">
    <div><span class="dot ${band}"></span>${band.toUpperCase()}</div>
    ${pending
      ? `<div class="price">Price not yet published</div>`
      : `<div class="price">${price.toFixed(2)}p per kWh</div>`}
    <div>${time}</div>
    ${pending ? `<div class="saving">Awaiting publication</div>` : savingText(price)}
  </div>`;
}

function clearHighlights(){
  document.querySelectorAll(".band-card").forEach(e=>{
    e.classList.remove("current");
  });
}

function highlightNow(){
  clearHighlights();

  const now=new Date();
  const m=now.getHours()*60+now.getMinutes();

  if(m>=1 && m<360) document.getElementById("today-green-early-card")?.classList.add("current");
  else if(m>=360 && m<960) document.getElementById("today-amber-card")?.classList.add("current");
  else if(m>=960 && m<1140) document.getElementById("today-red-card")?.classList.add("current");
  else document.getElementById("today-green-late-card")?.classList.add("current");
}

fetch("data.json?ts="+Date.now())
.then(r=>r.json())
.then(data=>{
  const t=data.today;
  const tom=data.tomorrow;

  buildCard("today-green-early","green",t.green.price,"00:01 - 06:00");
  buildCard("today-amber","amber",t.amber.price,"06:00 - 16:00 & 19:00 - 23:00");
  buildCard("today-red","red",t.red.price,"16:00 - 19:00");

  buildCard(
    "today-green-late",
    "green",
    tom.green ? tom.green.price : null,
    "23:00 - 00:00"
  );

  buildCard(
    "tomorrow-green-early",
    "green",
    tom.green ? tom.green.price : null,
    "00:01 - 06:00"
  );
  buildCard("tomorrow-amber","amber",tom.amber?.price ?? null,"06:00 - 16:00 & 19:00 - 23:00");
  buildCard("tomorrow-red","red",tom.red?.price ?? null,"16:00 - 19:00");

  highlightNow();
  setInterval(highlightNow,60000);
});
</script>

</body>
</html>
