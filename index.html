<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>EDF FreePhase Dynamic</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
    body {
        font-family: Arial, sans-serif;
        background: black;
        color: white;
        text-align: center;
        margin: 0;
        padding-bottom: 40px;
    }

    .container {
        width: 95%;
        margin: auto;
        max-width: 1000px;
    }

    .panel {
        background: #111;
        border-radius: 20px;
        margin: 25px 0;
        padding: 25px;
        box-shadow: 0 0 25px rgba(255,255,255,0.15);
    }

    h1, h2, h3 { margin: 10px 0; }

    .green-dot { color: #3dd33d; }
    .amber-dot { color: #e0c020; }
    .red-dot { color: #e03030; }

    .price {
        font-size: 2.3rem;
        font-weight: bold;
        margin: 10px 0 20px;
    }

    .range {
        font-size: 1.4rem;
        margin-top: 12px;
        line-height: 2.1rem;
    }

    .percent {
        font-size: 1rem;
        margin-top: 15px;
        opacity: 0.8;
    }

</style>

</head>

<body>

<div class="container">
    <h1>EDF FreePhase Dynamic - ST15 0WL</h1>
    <h3 id="timestamp">Loading…</h3>

    <h2>Today</h2>

    <div id="today-green"></div>
    <div id="today-amber"></div>
    <div id="today-red"></div>

    <h2>Tomorrow</h2>

    <div id="tomorrow-green"></div>
    <div id="tomorrow-amber"></div>
    <div id="tomorrow-red"></div>

</div>

<script>
// ----------- Utility Functions --------------

function fmtTime(iso) {
    const d = new Date(iso);
    return d.toLocaleTimeString("en-UK", { hour: "2-digit", minute: "2-digit" });
}

function percentDiff(price, baseline = 25.65) {
    const diff = ((price - baseline) / baseline) * 100;
    if (diff === 0) return "same as baseline";
    if (diff < 0) return `${Math.abs(diff).toFixed(0)} percent below baseline`;
    return `${diff.toFixed(0)} percent above baseline`;
}

function createBandPanel(title, colourClass, price, ranges, pctText) {
    if (!price) return "";

    const rangeStr = ranges.join(" and ");

    return `
    <div class="panel">
        <h3><span class="${colourClass}-dot">●</span> ${title}</h3>
        <div class="price">${price.toFixed(2)}p per kWh</div>
        <div class="range">${rangeStr}</div>
        <div class="percent">${pctText}</div>
    </div>`;
}

// ----------- Main Logic --------------

fetch("data.json")
    .then(r => r.json())
    .then(data => {

        document.getElementById("timestamp").textContent = new Date().toLocaleString("en-UK");

        // TODAY
        const tg = data.today.green;
        const ta = data.today.amber;
        const tr = data.today.red;

        document.getElementById("today-green").innerHTML = tg
            ? createBandPanel(
                "GREEN",
                "green",
                tg.price * 100,
                [ `${fmtTime(tg.start)} to ${fmtTime(tg.end)}` ],
                percentDiff(tg.price * 100)
              )
            : "";

        document.getElementById("today-amber").innerHTML = ta
            ? createBandPanel(
                "AMBER",
                "amber",
                ta.price * 100,
                [
                    "06:00 to 16:00",
                    "19:00 to 23:00"
                ],
                percentDiff(ta.price * 100)
              )
            : "";

        document.getElementById("today-red").innerHTML = tr
            ? createBandPanel(
                "RED",
                "red",
                tr.price * 100,
                [ `${fmtTime(tr.start)} to ${fmtTime(tr.end)}` ],
                percentDiff(tr.price * 100)
              )
            : "";

        // TOMORROW
        const mg = data.tomorrow.green;
        const ma = data.tomorrow.amber;
        const mr = data.tomorrow.red;

        document.getElementById("tomorrow-green").innerHTML = mg
            ? createBandPanel(
                "GREEN",
                "green",
                mg.price * 100,
                [ `${fmtTime(mg.start)} to ${fmtTime(mg.end)}` ],
                percentDiff(mg.price * 100)
              )
            : `<div class="panel"><h3><span class="green-dot">●</span> GREEN</h3><div class="range">Awaiting publication</div></div>`;

        document.getElementById("tomorrow-amber").innerHTML = ma
            ? createBandPanel(
                "AMBER",
                "amber",
                ma.price * 100,
                [
                    "06:00 to 16:00",
                    "19:00 to 23:00"
                ],
                percentDiff(ma.price * 100)
              )
            : `<div class="panel"><h3><span class="amber-dot">●</span> AMBER</h3><div class="range">Awaiting publication</div></div>`;

        document.getElementById("tomorrow-red").innerHTML = mr
            ? createBandPanel(
                "RED",
                "red",
                mr.price * 100,
                [ `${fmtTime(mr.start)} to ${fmtTime(mr.end)}` ],
                percentDiff(mr.price * 100)
              )
            : `<div class="panel"><h3><span class="red-dot">●</span> RED</h3><div class="range">Awaiting publication</div></div>`;
    });

</script>
</body>
</html>
