<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>EDF FreePhase Dynamic</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
    body {
        font-family: Arial, sans-serif;
        background: black;
        color: white;
        text-align: center;
        margin: 0;
        padding-bottom: 40px;
    }

    .container {
        width: 95%;
        margin: auto;
        max-width: 900px;
    }

    .panel {
        background: #111;
        border-radius: 20px;
        margin: 25px 0;
        padding: 25px;
        box-shadow: 0 0 25px rgba(255,255,255,0.15);
    }

    h1, h2, h3 { margin: 12px 0; }

    .green-dot { color: #3dd33d; }
    .amber-dot { color: #e0c020; }
    .red-dot { color: #e03030; }

    .price {
        font-size: 2.4rem;
        font-weight: bold;
        margin: 5px 0 15px;
    }

    .range {
        font-size: 1.5rem;
        margin-top: 12px;
        line-height: 2.2rem;
    }

    .percent {
        font-size: 1rem;
        margin-top: 18px;
        opacity: 0.8;
    }
</style>
</head>

<body>

<div class="container">
    <h1>EDF FreePhase Dynamic - ST15 0WL</h1>
    <h3 id="timestamp">Loading...</h3>

    <h2>Today</h2>
    <div id="today-green"></div>
    <div id="today-amber"></div>
    <div id="today-red"></div>

    <h2>Tomorrow</h2>
    <div id="tomorrow-green"></div>
    <div id="tomorrow-amber"></div>
    <div id="tomorrow-red"></div>
</div>

<script>
// Convert ISO to HH:MM
function fmtTime(iso) {
    return new Date(iso).toLocaleTimeString("en-UK", {
        hour: "2-digit",
        minute: "2-digit"
    });
}

// Percent difference vs baseline (25.65p)
function percentDiff(pricePence, baseline = 25.65) {
    const diff = ((pricePence - baseline) / baseline) * 100;
    if (diff < 0) return `${Math.abs(diff).toFixed(0)} percent below baseline`;
    if (diff > 0) return `${diff.toFixed(0)} percent above baseline`;
    return `same as baseline`;
}

// Generate panel
function createPanel(name, dotClass, price, start, end, pctText) {
    return `
    <div class="panel">
        <h3><span class="${dotClass}-dot">●</span> ${name}</h3>
        <div class="price">${price.toFixed(2)}p per kWh</div>
        <div class="range">${fmtTime(start)} to ${fmtTime(end)}</div>
        <div class="percent">${pctText}</div>
    </div>`;
}

fetch("data.json")
    .then(resp => resp.json())
    .then(data => {

        document.getElementById("timestamp").textContent =
            new Date().toLocaleString("en-UK");

        // TODAY BANDS
        const t = data.today;

        document.getElementById("today-green").innerHTML = t.green ?
            createPanel(
                "GREEN",
                "green",
                t.green.price * 100,
                t.green.start,
                t.green.end,
                percentDiff(t.green.price * 100)
            ) : "";

        document.getElementById("today-amber").innerHTML = t.amber ?
            `
            <div class="panel">
                <h3><span class="amber-dot">●</span> AMBER</h3>
                <div class="price">${(t.amber.price * 100).toFixed(2)}p per kWh</div>
                <div class="range">06:00 to 16:00<br>19:00 to 23:00</div>
                <div class="percent">${percentDiff(t.amber.price * 100)}</div>
            </div>
            ` : "";

        document.getElementById("today-red").innerHTML = t.red ?
            createPanel(
                "RED",
                "red",
                t.red.price * 100,
                t.red.start,
                t.red.end,
                percentDiff(t.red.price * 100)
            ) : "";

        // TOMORROW BANDS
        const tm = data.tomorrow;

        document.getElementById("tomorrow-green").innerHTML = tm.green ?
            createPanel(
                "GREEN",
                "green",
                tm.green.price * 100,
                tm.green.start,
                tm.green.end,
                percentDiff(tm.green.price * 100)
            )
            : `<div class="panel"><h3><span class="green-dot">●</span> GREEN</h3><div class="range">Awaiting publication</div></div>`;

        document.getElementById("tomorrow-amber").innerHTML = tm.amber ?
            `
            <div class="panel">
                <h3><span class="amber-dot">●</span> AMBER</h3>
                <div class="price">${(tm.amber.price * 100).toFixed(2)}p per kWh</div>
                <div class="range">06:00 to 16:00<br>19:00 to 23:00</div>
                <div class="percent">${percentDiff(tm.amber.price * 100)}</div>
            </div>
            `
            : `<div class="panel"><h3><span class="amber-dot">●</span> AMBER</h3><div class="range">Awaiting publication</div></div>`;

        document.getElementById("tomorrow-red").innerHTML = tm.red ?
            createPanel(
                "RED",
                "red",
                tm.red.price * 100,
                tm.red.start,
                tm.red.end,
                percentDiff(tm.red.price * 100)
            )
            : `<div class="panel"><h3><span class="red-dot">●</span> RED</h3><div class="range">Awaiting publication</div></div>`;
    });
</script>

</body>
</html>
