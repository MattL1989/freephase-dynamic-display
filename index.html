<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>EDF FreePhase Dynamic</title>

<style>
body { background:#000; color:#fff; font-family:"Segoe UI",Arial; text-align:center; margin:0 }
header { padding:30px 0 10px }
h1 { font-size:42px; margin-bottom:5px }
.clock { color:#bbb; margin-bottom:25px }
h2 { font-size:28px; margin:30px 0 10px }

.band-card {
  width:90%;
  margin:15px auto;
  padding:25px;
  border-radius:18px;
  font-size:26px;
}
.band-card.current { border:2px solid #fff }

.green { background:#1f8f2e }
.amber { background:#c9a200 }
.red { background:#b00000 }

.dot {
  height:18px; width:18px; border-radius:50%;
  display:inline-block; margin-right:10px
}
.dot.green { background:#58d46d }
.dot.amber { background:#ffd84a }
.dot.red { background:#ff4c4c }

.price { font-size:34px; font-weight:bold }
.saving { font-size:18px }
.greyed { opacity:.35; border:2px dashed #666 }
</style>
</head>

<body>

<header>
<h1>EDF FreePhase Dynamic - ST15 0WL</h1>
<div class="clock" id="clock"></div>
</header>

<h2>Today</h2>
<div id="today-green-early"></div>
<div id="today-amber"></div>
<div id="today-red"></div>
<div id="today-green-late"></div>

<h2>Tomorrow</h2>
<div id="tomorrow-green-early"></div>
<div id="tomorrow-amber"></div>
<div id="tomorrow-red"></div>

<script>
const BASELINE = 25.65;

function updateClock(){
  document.getElementById("clock").textContent =
    new Date().toLocaleString("en-GB");
}
setInterval(updateClock,1000); updateClock();

function savingText(price){
  const pct=((BASELINE-price)/BASELINE)*100;
  return pct>=0
    ? `<div class="saving">▼ ${pct.toFixed(0)} percent below baseline</div>`
    : `<div class="saving">▲ ${Math.abs(pct).toFixed(0)} percent above baseline</div>`;
}

function card(id, band, price, time){
  const el=document.getElementById(id);
  const pending=price==null;
  el.innerHTML=`
  <div class="band-card ${band} ${pending?"greyed":""}">
    <div><span class="dot ${band}"></span>${band.toUpperCase()}</div>
    ${pending ? `<div class="price">Price not yet published</div>`
              : `<div class="price">${price.toFixed(2)}p per kWh</div>`}
    <div>${time}</div>
    ${pending ? `<div class="saving">Awaiting publication</div>` : savingText(price)}
  </div>`;
}

fetch("data.json?ts="+Date.now())
.then(r=>r.json())
.then(data=>{
  const now=new Date();
  const hour=now.getHours();

  const today=data.today;
  const tomorrow=data.tomorrow;

  // Today always shows its own prices
  card("today-green-early","green",today.green.price,"00:01 - 06:00");
  card("today-amber","amber",today.amber.price,"06:00 - 16:00 & 19:00 - 23:00");
  card("today-red","red",today.red.price,"16:00 - 19:00");

  // Overnight ownership
  if(hour < 6){
    // Overnight belongs to TODAY only
    card("today-green-late","green",today.green.price,"23:00 - 00:00");
    card("tomorrow-green-early","green",null,"00:01 - 06:00");
  } else {
    // Overnight belongs to TOMORROW when published
    card("today-green-late","green",null,"23:00 - 00:00");
    card("tomorrow-green-early","green",tomorrow.green?.price ?? null,"00:01 - 06:00");
  }

  card("tomorrow-amber","amber",tomorrow.amber?.price ?? null,"06:00 - 16:00 & 19:00 - 23:00");
  card("tomorrow-red","red",tomorrow.red?.price ?? null,"16:00 - 19:00");
});
</script>

</body>
</html>
